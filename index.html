<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>噪音之家T恤復刻預購｜噪T復刻</title>
  <style>
    :root {
      --pink:#ff67a5;
      --pink-600:#ff5099;
      --pink-700:#ff2f8b;
      --blue:#8fd3ff;
      --gray-100:#f5f5f7;
      --gray-200:#ececf0;
      --gray-400:#b5b5be;
      --gray-600:#6b7280;
      --text:#222;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--text); background:#fff}
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    /* Top banner */
    .topbar{background:var(--pink); color:#fff; text-align:center; font-weight:800; letter-spacing:.5px;}
    .topbar .inner{max-width:1200px;margin:0 auto;padding:14px 16px;font-size:20px}

    /* Layout */
    .grid{display:grid; gap:24px}
    @media (min-width: 960px){
      .grid.shop{grid-template-columns: 1.1fr .9fr}
    }

    /* Gallery */
    .hero{border:1px solid var(--gray-200); border-radius:16px; overflow:hidden; background:#fff; position:relative;}
    .hero img{display:block; width:100%; height:auto;}
    .thumbs{display:flex; gap:10px; overflow:auto; padding:12px 4px}
    .thumbs img{width:84px; height:84px; object-fit:cover; border-radius:12px; border:2px solid transparent; cursor:pointer; background:#fff}
    .thumbs img.active{border-color:var(--pink)}

    /* Product panel */
    .card{border:1px solid var(--gray-200); border-radius:16px; padding:18px}
    h1{font-size:24px; margin:0 0 6px; font-weight:800}
    .desc{color:#444; line-height:1.6; margin:0 0 14px;}

    label{font-size:13px; color:#333; margin:8px 0 6px; display:block; font-weight:700}
    select, input[type="text"], input[type="tel"], input[type="search"]{width:100%; padding:12px 12px; border:1px solid var(--gray-200); border-radius:12px; font-size:14px; background:#fff}

    .price{font-weight:900; color:var(--pink-700); font-size:20px; margin:8px 0 12px}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; border:0; padding:12px 18px; font-weight:800; cursor:pointer; border-radius:999px; transition:.2s transform;}
    .btn:active{transform:scale(.98)}
    .btn-primary{background: linear-gradient(135deg, var(--pink), var(--blue)); color:#fff}
    .btn-ghost{background:#fff; border:1px solid var(--gray-200)}

    .divider{height:1px; background:var(--gray-200); margin:28px 0}

    /* Floating cart */
    .cart{position:fixed; top:0; right:0; width:360px; max-width:90vw; height:100vh; background:#fff; border-left:1px solid var(--gray-200); transform:translateX(100%); transition:.28s transform; z-index:50; display:flex; flex-direction:column}
    .cart.open{transform:translateX(0)}
    .cart header{padding:14px 16px; border-bottom:1px solid var(--gray-200); display:flex; align-items:center; justify-content:space-between}
    .cart h3{margin:0; font-size:18px}
    .cart .body{flex:1; overflow:auto; padding:12px 12px 100px}
    .cart .group{padding:6px 0 0}
    .cart .group h4{margin:16px 6px 8px; font-size:14px; color:#111}
    .cart .item{display:grid; grid-template-columns: 1fr auto; gap:10px; padding:10px; border:1px solid var(--gray-200); border-radius:12px; margin-bottom:10px}
    .meta{font-size:13px; color:#333}
    .muted{color:var(--gray-600)}
    .qty{display:inline-flex; align-items:center; gap:6px}
    .qty button{width:28px; height:28px; border-radius:999px; border:1px solid var(--gray-200); background:#fff; font-weight:800}
    .cart footer{position:sticky; bottom:0; background:#fff; border-top:1px solid var(--gray-200); padding:12px; display:flex; flex-direction:column; gap:10px}
    .totals{display:flex; align-items:center; justify-content:space-between; font-weight:800}

    /* Product description section */
    .longcopy{line-height:1.9; color:#333}
    .detail-img{width:100%; border:1px solid var(--gray-200); border-radius:16px}

    /* Pages */
    .page{display:none}
    .page.active{display:block}

    /* Table */
    table{width:100%; border-collapse:collapse;}
    th, td{padding:10px; border-bottom:1px solid var(--gray-200); text-align:left}
    tfoot td{font-weight:900}

    /* Tiny util */
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .grow{flex:1}
    .right{text-align:right}
    .mb8{margin-bottom:8px}
    .mb16{margin-bottom:16px}
    .mb24{margin-bottom:24px}
    .tag{display:inline-block; padding:3px 8px; border-radius:999px; background:#f7f7fb; border:1px solid var(--gray-200); font-size:12px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="inner">噪音之家T恤復刻預購</div>
  </div>

  <main class="container">
    <!-- SHOP PAGE -->
    <section id="page-shop" class="page active">
      <div class="grid shop">
        <!-- Left: gallery -->
        <div>
          <div class="hero"><img id="heroImg" src="" alt="商品預覽" /></div>
          <div id="thumbs" class="thumbs" aria-label="商品縮圖列"></div>
        </div>

        <!-- Right: product panel -->
        <div class="card">
          <h1>噪音之家T恤復刻預購</h1>
          <p class="desc" id="desc">
            歷年款式重返舞台。
            限時不限量預購，下一次不知道甚麼時候會再開
            請把握機會購買!
          </p>

          <label for="styleSel">購買款式</label>
          <select id="styleSel"></select>

          <label for="colorSel">顏色</label>
          <select id="colorSel"></select>

          <label for="sizeSel">尺寸</label>
          <select id="sizeSel"></select>

          <div class="price"><span id="priceText">NT.690元/件</span></div>
          <div class="row">
            <button class="btn btn-primary" id="addBtn">加入購物車</button>
            <button class="btn btn-ghost" id="openCartBtn">查看購物車</button>
          </div>

          <div class="divider"></div>

          <div>
            <h3 style="margin:0 0 10px">商品說明</h3>
            <div class="longcopy" id="longcopy">
             音源線Ｔ為新廠商，材質與舒適度暫不明，
             請大家一起陪我踩踩看，真摯感謝ㄉ心
            </div>
            <div id="detailImages" class="mb24" style="margin-top:14px; display:grid; gap:12px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONFIRM PAGE -->
    <section id="page-confirm" class="page">
      <h2 class="mb8">確認購買</h2>
      <p class="muted mb16">請再度確認您的購物明細，並填寫聯絡資料。</p>

      <div id="confirmTableWrap" class="mb16"></div>

      <div class="card" style="margin-bottom:16px">
        <div class="row">
          <div class="grow">
            <label for="buyerName">購買人名稱（必填）</label>
            <input id="buyerName" type="text" placeholder="王小明" />
          </div>
          <div class="grow">
            <label for="buyerContact">聯絡方式（必填）</label>
            <input id="buyerContact" type="text" placeholder="Plurk或 FB" />
          </div>
        </div>
      </div>
 
      <div class="row">
        <button class="btn btn-ghost" id="backToShop">返回購物</button>
        <div class="grow"></div>
        <button class="btn btn-primary" id="submitOrder">確認送出</button>
      </div>
    </section>

    <!-- THANKS PAGE -->
    <section id="page-thanks" class="page">
      <div class="card" style="text-align:center; padding:40px 20px">
        <h2>感謝您的購買，我們會盡快與您聯繫！</h2>
        <p class="muted">可回到首頁繼續選購。</p>
        <div style="margin-top:12px"><a href="#shop" class="btn btn-ghost">回首頁</a></div>
      </div>
    </section>

    <!-- (Optional) ADMIN PAGE -->
    <section id="page-admin" class="page">
      <div class="row mb16" style="align-items:center">
        <h2 class="grow">後台訂單列表</h2>
        <a class="tag" href="#shop">← 回購物頁</a>
      </div>
      <div class="card mb16">
        <div class="row">
          <div class="grow">
            <label for="qName">搜尋：名稱</label>
            <input id="qName" type="search" placeholder="王小明" />
          </div>
          <div class="grow">
            <label for="qContact">搜尋：聯絡方式</label>
            <input id="qContact" type="search" placeholder="09xx / mail" />
          </div>
          <div class="grow">
            <label for="qDate">日期（YYYY-MM-DD）</label>
            <input id="qDate" type="search" placeholder="2025-08-15" />
          </div>
        </div>
      </div>
      <div id="adminTableWrap" class="mb16"></div>
      <div class="row">
        <button class="btn btn-ghost" id="exportCsv">匯出 CSV</button>
        <div class="grow"></div>
        <button class="btn btn-primary" id="clearOrders">清空全部（本機）</button>
      </div>
    </section>
  </main>

  <!-- Floating Cart Panel -->
  <aside class="cart" id="cart">
    <header>
      <h3>購物車</h3>
      <button class="btn btn-ghost" id="closeCart">關閉</button>
    </header>
    <div class="body" id="cartBody"></div>
    <footer>
      <div class="totals"><span>小計</span><span id="cartTotal">NT.0</span></div>
      <button class="btn btn-primary" id="goCheckout">結帳</button>
    </footer>
  </aside>

  <script>
  /***********************
   * 可編輯的商品資料區
   ***********************/
  const PRODUCTS = [
    {
      id: '2025-pixel-feng',
      name: '2025-像素風噪四T',
      price: 690,
      colors: ['黑色'],
      sizes: ['S','M','L','XL','XXL'],
      images: [
        // 請把圖片放進 images/ 底下，或改成你自己的路徑
        'images/4people.png',
         'images/size01.jpg'
      ],
      detailImages: [
         'images/4people.png'
      ],
      colorAvailability: { '黑色': true, '白色': false },
    },
    {
      id: '2025-classic-logo',
      name: '2024-噪音之家與好友們',
      price: 690,
      colors: ['白色'], // 限定色示範
      sizes: ['S','M','L','XL','XXL'],
      images: [
        'images/9people.png',
        'images/size01.jpg'
      ],
      detailImages: [ 'images/9people.png'],
      colorAvailability: { '黑色': false, '白色': true },
    },
    {
      id: '2023-logo',
      name: '2023-PARSON LOGO款',
      price: 690,
      colors: ['白色','黑色'], // 限定色示範
      sizes: ['S','M','L','XL','XXL'],
      images: [
        'images/PARSON.png',
        'images/size01.jpg'
      ],
      detailImages: ['images/PARSON.png'],
      colorAvailability: { '黑色': true, '白色': true },
    },
      {
      id: '2021-OKM',
      name: '2021-OKM手繪音源線款',
      price: 450,
      colors: ['白色','黑色'], // 限定色示範
      sizes: ['S','M','L','XL','XXL'],
      images: [
        'images/OKM.png',
        'images/SIZE02.png',
         'images/LOGO_BIG.png'
      ],
      detailImages: ['images/OKM.png'],
      colorAvailability: { '黑色': true, '白色': true },
    },
  ];

  /***********************
   * 狀態（存在記憶體 + 本機儲存）
   ***********************/
  const state = {
    selectedStyleId: PRODUCTS[0]?.id,
    selectedColor: null,
    selectedSize: null,
    selectedImageIndex: 0,
    cart: JSON.parse(localStorage.getItem('cart')||'[]'),
  };

  function saveCart(){ localStorage.setItem('cart', JSON.stringify(state.cart)); }

  /***********************
   * 工具
   ***********************/
  const $$ = sel => document.querySelector(sel);
  function formatNT(n){ return 'NT.' + n.toLocaleString('zh-Hant-TW') }
  function groupBy(arr, keyFn){
    return arr.reduce((acc, item)=>{
      const k = keyFn(item);
      (acc[k] = acc[k] || []).push(item);
      return acc;
    }, {});
  }
  function uid(){ return 'Z' + Date.now().toString(36) + Math.random().toString(36).slice(2,6).toUpperCase(); }

  /***********************
   * 初始化下拉
   ***********************/
  const styleSel = $$('#styleSel');
  const colorSel = $$('#colorSel');
  const sizeSel  = $$('#sizeSel');
  const priceText= $$('#priceText');
  const heroImg  = $$('#heroImg');
  const thumbs   = $$('#thumbs');
  const detailImages = $$('#detailImages');

  function currentProduct(){
    return PRODUCTS.find(p=>p.id===state.selectedStyleId);
  }

  function refreshStyleOptions(){
    styleSel.innerHTML = PRODUCTS.map(p=><option value="${p.id}">${p.name}</option>).join('');
    styleSel.value = state.selectedStyleId;
  }

  function refreshColorSize(){
    const p = currentProduct();
    // 顏色
    colorSel.innerHTML = p.colors.map(c=>{
      const disabled = p.colorAvailability && p.colorAvailability[c]===false ? 'disabled' : '';
      return <option ${disabled} value="${c}">${c}${disabled? '（暫無）':''}</option>;
    }).join('');
    // 預設值
    state.selectedColor = p.colors.find(c=>!p.colorAvailability || p.colorAvailability[c]!==false) || p.colors[0];
    colorSel.value = state.selectedColor;

    // 尺寸
    sizeSel.innerHTML = p.sizes.map(s=><option value="${s}">${s}</option>).join('');
    state.selectedSize = p.sizes[0];
    sizeSel.value = state.selectedSize;

    // 價格
    priceText.textContent = ${formatNT(p.price)} / 件;

    // 圖片
    state.selectedImageIndex = 0;
    refreshImages();
  }

  function refreshImages(){
    const p = currentProduct();
    const imgs = p.images && p.images.length ? p.images : ['https://via.placeholder.com/1000x1000?text=T-Shirt'];
    heroImg.src = imgs[state.selectedImageIndex] || imgs[0];
    thumbs.innerHTML = imgs.map((src,i)=><img src="${src}" data-idx="${i}" class="${i===state.selectedImageIndex?'active':''}" alt="縮圖${i+1}" />).join('');

    // 詳細圖
    const ds = p.detailImages && p.detailImages.length ? p.detailImages : [];
    detailImages.innerHTML = ds.map(src=><img class="detail-img" src="${src}" alt="商品詳細圖" />).join('');
  }

  thumbs.addEventListener('click', (e)=>{
    const idx = e.target?.dataset?.idx;
    if(idx!=null){
      state.selectedImageIndex = Number(idx);
      refreshImages();
    }
  });

  styleSel.addEventListener('change', ()=>{
    state.selectedStyleId = styleSel.value;
    refreshColorSize();
  });
  colorSel.addEventListener('change', ()=>{
    state.selectedColor = colorSel.value;
  });
  sizeSel.addEventListener('change', ()=>{
    state.selectedSize = sizeSel.value;
  });

  /***********************
   * 購物車
   ***********************/
  const cartEl = $$('#cart');
  const cartBody = $$('#cartBody');
  const cartTotal = $$('#cartTotal');
  const openCartBtn = $$('#openCartBtn');
  const closeCartBtn = $$('#closeCart');
  const addBtn = $$('#addBtn');
  const goCheckoutBtn = $$('#goCheckout');

  openCartBtn.addEventListener('click', ()=>cartEl.classList.add('open'));
  closeCartBtn.addEventListener('click', ()=>cartEl.classList.remove('open'));

  addBtn.addEventListener('click', ()=>{
    const p = currentProduct();
    const itemKey = ${p.id}|${state.selectedColor}|${state.selectedSize};
    const exist = state.cart.find(x=>x.key===itemKey);
    if(exist){ exist.qty += 1; }
    else{
      state.cart.push({
        key:itemKey,
        styleId:p.id,
        styleName:p.name,
        color:state.selectedColor,
        size:state.selectedSize,
        price:p.price,
        qty:1
      });
    }
    saveCart();
    renderCart();
    cartEl.classList.add('open');
  });

  function renderCart(){
    if(state.cart.length===0){
      cartBody.innerHTML = '<p class="muted">尚無商品。</p>';
      cartTotal.textContent = formatNT(0);
      return;
    }
    // 依款式分組顯示
    const groups = groupBy(state.cart, it=>it.styleName);
    cartBody.innerHTML = Object.entries(groups).map(([style,items])=>{
      return 
        <div class="group">
          <h4>${style}</h4>
          ${items.map(it=>
            <div class="item" data-key="${it.key}">
              <div>
                <div class="meta"><b>${it.color}</b> ／ ${it.size}</div>
                <div class="muted">單價 ${formatNT(it.price)}｜小計 ${formatNT(it.price*it.qty)}</div>
              </div>
              <div class="qty">
                <button data-act="dec">-</button>
                <span>${it.qty}</span>
                <button data-act="inc">+</button>
                <button data-act="del" title="刪除" style="margin-left:8px">✕</button>
              </div>
            </div>
          ).join('')}
        </div>
      ;
    }).join('');

    const total = state.cart.reduce((s,it)=>s+it.price*it.qty,0);
    cartTotal.textContent = formatNT(total);
  }

  cartBody.addEventListener('click', (e)=>{
    const act = e.target?.dataset?.act;
    if(!act) return;
    const itemEl = e.target.closest('.item');
    const key = itemEl?.dataset?.key;
    const it = state.cart.find(x=>x.key===key);
    if(!it) return;

    if(act==='inc') it.qty += 1;
    if(act==='dec') it.qty = Math.max(1, it.qty-1);
    if(act==='del') state.cart = state.cart.filter(x=>x.key!==key);

    saveCart();
    renderCart();
  });

  goCheckoutBtn.addEventListener('click', ()=>{
    if(state.cart.length===0){ alert('購物車為空'); return; }
    routeTo('#confirm');
    cartEl.classList.remove('open');
    renderConfirm();
  });

  /***********************
   * 確認頁
   ***********************/
  const backToShopBtn = $$('#backToShop');
  const submitOrderBtn = $$('#submitOrder');

  backToShopBtn.addEventListener('click', ()=>routeTo('#shop'));

  function renderConfirm(){
    const wrap = $$('#confirmTableWrap');
    if(state.cart.length===0){ wrap.innerHTML = '<p class="muted">無項目</p>'; return; }

    const rows = state.cart.map(it=>
      <tr data-key="${it.key}">
        <td>${it.styleName}</td>
        <td>${it.color}</td>
        <td>${it.size}</td>
        <td class="right">${formatNT(it.price)}</td>
        <td class="right">
          <div class="qty" style="justify-content:flex-end">
            <button data-act="dec">-</button>
            <span>${it.qty}</span>
            <button data-act="inc">+</button>
          </div>
        </td>
        <td class="right"><button data-act="del" class="btn btn-ghost">刪除</button></td>
      </tr>
    ).join('');

    const total = state.cart.reduce((s,it)=>s+it.price*it.qty,0);
    wrap.innerHTML = 
      <div class="card">
        <div style="overflow:auto">
          <table>
            <thead>
              <tr><th>款式</th><th>顏色</th><th>尺寸</th><th class="right">單價</th><th class="right">數量</th><th class="right">操作</th></tr>
            </thead>
            <tbody>${rows}</tbody>
            <tfoot><tr><td colspan="6" class="right">合計：${formatNT(total)}</td></tr></tfoot>
          </table>
        </div>
      </div>
    ;

    // 事件委派：加減刪除購物車商品
wrap.querySelector('tbody').addEventListener('click', (e)=>{
  const act = e.target?.dataset?.act;
  if(!act) return;
  const tr = e.target.closest('tr');
  const key = tr?.dataset?.key;
  const it = state.cart.find(x=>x.key===key);
  if(!it) return;
  if(act==='inc') it.qty += 1;
  if(act==='dec') it.qty = Math.max(1, it.qty-1);
  if(act==='del') state.cart = state.cart.filter(x=>x.key!==key);
  saveCart();
  renderConfirm();
  renderCart();
}, { once:false });

// 送出訂單
/***********************
 * 下單 & LocalStorage + Google Sheet
 ***********************/
submitOrderBtn.addEventListener('click', ()=>{

  const name = $$('#buyerName').value.trim();
  const contact = $$('#buyerContact').value.trim();
  if(!name || !contact){ alert('請填寫必填欄位'); return; }

  const orderId = Date.now();
  const items = state.cart.map(it => ({
    styleName: it.styleName,
    color: it.color,
    size: it.size,
    unitPrice: it.price,
    qty: it.qty,
    subtotal: it.price * it.qty
  }));

  const total = items.reduce((sum,x)=>sum+x.subtotal,0);

  const order = {
    orderId,
    buyerName: name,
    contact,
    items,           // 保留陣列格式
    total,
    createdAt: new Date().toISOString()
  };

  // 存本機 LocalStorage
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  orders.unshift(order);
  localStorage.setItem('orders', JSON.stringify(orders));

  // 送到 Google Sheet
  const formattedItems = items.map(i=>${i.styleName}-${i.color}-${i.size}).join(", ");
  const orderData = {
    orderId,
    name,
    contact,
    items: formattedItems,  // 字串格式送到 Sheet
    total
  };

  fetch("https://script.google.com/macros/s/AKfycbxxEfhvVmXYR9KqI2IuSCHSjM2cwY7zzN_UiGA_KxwhwoQlxe2g4uG6hmzxCQR8z5M4/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(orderData),
    mode: "no-cors" // 靜態頁面必須
  });

  // 清空購物車
  state.cart = [];
  saveCart();
  renderCart();
  routeTo('#thanks');
  alert("訂單已送出！請打開 Google Sheet 確認");
});

  /***********************
 * 後台頁（本機）
 ***********************/
const adminWrap = $$('#adminTableWrap');

/***********************
 * #admin 後台
 ***********************/
function renderAdmin(){
  const adminWrap = $$('#adminTableWrap');
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  const qName = $$('#qName').value.trim();
  const qContact = $$('#qContact').value.trim();
  const qDate = $$('#qDate').value.trim();

  const filtered = orders.filter(o=>{
    const okName = !qName || o.buyerName.includes(qName);
    const okContact = !qContact || o.contact.includes(qContact);
    const okDate = !qDate || (o.createdAt||'').slice(0,10)===qDate;
    return okName && okContact && okDate;
  });

  if(filtered.length===0){ adminWrap.innerHTML='<p class="muted">目前沒有符合條件的訂單。</p>'; return; }

  const rows = filtered.map(o=>{
    const itemsStr = Array.isArray(o.items)
      ? o.items.map(i=>${i.styleName}／${i.color}／${i.size} ×${i.qty}（${formatNT(i.subtotal)}）).join('<br>')
      : o.items;

    return <tr>
      <td><b>${o.orderId}</b><div class="muted">${(o.createdAt||'').replace('T',' ').slice(0,16)}</div></td>
      <td>${o.buyerName}</td>
      <td>${o.contact}</td>
      <td>${itemsStr}</td>
      <td class="right">${formatNT(o.total)}</td>
    </tr>;
  }).join('');

  adminWrap.innerHTML = 
    <div class="card" style="overflow:auto">
      <table>
        <thead>
          <tr><th>訂單編號／時間</th><th>名稱</th><th>聯絡</th><th>明細</th><th class="right">總金額</th></tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  ;
}

$$('#qName')?.addEventListener('input', renderAdmin);
$$('#qContact')?.addEventListener('input', renderAdmin);
$$('#qDate')?.addEventListener('input', renderAdmin);

// 匯出 CSV
$$('#exportCsv')?.addEventListener('click', ()=>{
  const orders = JSON.parse(localStorage.getItem('orders')||'[]');
  if(!orders.length){ alert('沒有資料'); return; }

  const headers = ['訂單編號','購買人','聯絡方式','款式','顏色','尺寸','單價','數量','小計','總金額','建立時間'];
  const lines = [headers.join(',')];

  orders.forEach(o=>{
    if(Array.isArray(o.items)){
      o.items.forEach(i=>{
        lines.push([
          o.orderId,
          '"'+o.buyerName.replaceAll('"','""')+'"',
          '"'+o.contact.replaceAll('"','""')+'"',
          '"'+i.styleName+'"',
          i.color,
          i.size,
          i.unitPrice,
          i.qty,
          i.subtotal,
          o.total,
          o.createdAt
        ].join(','));
      });
    }
  });

  const blob = new Blob(["\ufeff" + lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'orders.csv'; a.click();
  URL.revokeObjectURL(url);
});

// 清空本機訂單
$$('#clearOrders')?.addEventListener('click', ()=>{
  if(confirm('確定要清空本機訂單資料？此操作無法復原')){
    localStorage.removeItem('orders');
    renderAdmin();
  }
});
